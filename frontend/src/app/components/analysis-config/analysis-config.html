<!--src/app/components/analysis-config/analysis-config.html-->
<div class="analysis-config">
  
  <!-- Header -->
  <div class="form-header">
    <h2>‚öôÔ∏è Configuraci√≥n del An√°lisis</h2>
    <p class="form-description">
      Configure los par√°metros de la simulaci√≥n farmacocin√©tica
    </p>
  </div>

  <!-- Resumen de pasos anteriores -->
  <div class="previous-steps-summary">
    <div class="step-card" *ngIf="patientData">
      <div class="step-icon">üë§</div>
      <div class="step-info">
        <strong>Paciente</strong>
        <span>{{ patientData.weight }}kg, TFG: {{ patientData.calculated_gfr }} mL/min</span>
      </div>
    </div>

    <div class="step-card" *ngIf="medicationData">
      <div class="step-icon">üíä</div>
      <div class="step-info">
        <strong>Medicamento</strong>
        <span>{{ medicationData.medication }}, {{ medicationData.dose }}mg</span>
      </div>
    </div>
  </div>

  <form (ngSubmit)="onSubmit()" class="form-content">
    
    <!-- Campo: Tiempo a Simular -->
    <div class="form-field">
      <label for="timeToSimulate" class="field-label">
        Tiempo a Simular
        <span class="required">*</span>
      </label>
      <div class="input-with-tooltip">
        <div class="slider-wrapper">
          <input 
            type="range" 
            id="timeToSimulate"
            [(ngModel)]="configData.timeToSimulate"
            name="timeToSimulate"
            min="1"
            max="48"
            step="1"
            class="slider">
          <div class="slider-value">
            {{ configData.timeToSimulate }} horas
          </div>
        </div>
        <div class="tooltip-icon" title="Periodo de tiempo para simular la concentraci√≥n del medicamento en sangre">
          ‚ùì
        </div>
      </div>
      <small class="field-hint">Desliza para seleccionar entre 1 y 48 horas</small>
    </div>

    <!-- Campo: Resoluci√≥n/Precisi√≥n -->
    <div class="form-field">
      <label class="field-label">
        Precisi√≥n del C√°lculo
        <span class="required">*</span>
      </label>
      
      <div class="resolution-options">
        <div 
          *ngFor="let option of resolutionOptions"
          class="resolution-card"
          [class.selected]="configData.resolution === option.value"
          (click)="configData.resolution = option.value">
          
          <div class="resolution-icon">{{ option.icon }}</div>
          <div class="resolution-label">{{ option.label }}</div>
          <div class="resolution-points">{{ option.points }} puntos</div>
          <div class="resolution-description">{{ option.description }}</div>
          
          <div class="selection-indicator" *ngIf="configData.resolution === option.value">
            ‚úì
          </div>
        </div>
      </div>

      <div class="resolution-info">
        <p>
          <strong>Puntos calculados:</strong> {{ getNumPoints() }}
          <br>
          <strong>Tiempo estimado:</strong> {{ getEstimatedTime() }}
        </p>
      </div>
    </div>

    <!-- Opciones adicionales -->
    <div class="form-field">
      <label class="field-label">Opciones de Visualizaci√≥n</label>
      
      <div class="checkbox-group">
        
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="configData.showTherapeuticLevels"
            name="showTherapeuticLevels">
          <span class="checkbox-text">
            <strong>Mostrar niveles terap√©uticos</strong>
            <small>Muestra las l√≠neas de nivel m√≠nimo y m√°ximo en la gr√°fica</small>
          </span>
        </label>

        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="configData.showProcedure"
            name="showProcedure">
          <span class="checkbox-text">
            <strong>Mostrar procedimiento matem√°tico</strong>
            <small>Incluye el desarrollo paso a paso de los c√°lculos</small>
          </span>
        </label>

        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="configData.saveToHistory"
            name="saveToHistory">
          <span class="checkbox-text">
            <strong>Guardar en historial</strong>
            <small>Permite comparar con simulaciones futuras</small>
          </span>
        </label>

      </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="onBack()">
        ‚Üê Volver a Medicamento
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="!isValid()">
        üßÆ Calcular Simulaci√≥n
      </button>
    </div>

  </form>

  <!-- Resumen de configuraci√≥n -->
  <div class="data-preview" *ngIf="isValid()">
    <h4>üìã Resumen de Configuraci√≥n:</h4>
    <ul>
      <li><strong>Tiempo de simulaci√≥n:</strong> {{ configData.timeToSimulate }} horas</li>
      <li><strong>Precisi√≥n:</strong> {{ getSelectedResolution()?.label }} ({{ getNumPoints() }} puntos)</li>
      <li><strong>Niveles terap√©uticos:</strong> {{ configData.showTherapeuticLevels ? 'S√≠' : 'No' }}</li>
      <li><strong>Procedimiento matem√°tico:</strong> {{ configData.showProcedure ? 'S√≠' : 'No' }}</li>
      <li><strong>Guardar en historial:</strong> {{ configData.saveToHistory ? 'S√≠' : 'No' }}</li>
    </ul>
  </div>

</div>