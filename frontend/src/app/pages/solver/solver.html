<div class="solver-page">
  
  <!-- Header -->
  <div class="page-header">
    <h1>游눍 MediLab Control - Calculadora de Farmacocin칠tica</h1>
    <p>Calcula concentraciones de medicamentos usando ecuaciones diferenciales</p>
  </div>

  <!-- Stepper -->
  <app-stepper [currentStep]="currentStep" [totalSteps]="totalSteps"></app-stepper>

  <!-- CONTENIDO SEG칔N EL PASO -->
  <div class="wizard-content">

    <!-- PASO 1: Datos del Paciente -->
    <app-patient-form 
      *ngIf="currentStep === 1"
      (dataSubmitted)="onPatientDataSubmitted($event)"
      (cancel)="onCancel()">
    </app-patient-form>

    <!-- PASO 2: Medicamento y Dosis -->
    <app-medication-form
      *ngIf="currentStep === 2"
      [patientData]="patientData"
      (dataSubmitted)="onMedicationDataSubmitted($event)"
      (back)="previousStep()">
    </app-medication-form>

    <!-- PASO 3: Configuraci칩n de An치lisis -->
    <app-analysis-config
      *ngIf="currentStep === 3"
      [patientData]="patientData"
      [medicationData]="medicationData"
      (dataSubmitted)="onConfigDataSubmitted($event)"
      (back)="previousStep()">
    </app-analysis-config>

    <!-- PASO 4: Resultados -->
    <div *ngIf="currentStep === 4" class="results-container">
      
      <div class="results-header">
        <h2>游늵 Resultados de la Simulaci칩n</h2>
        <button class="btn-new-simulation" (click)="onCancel()">
          游댃 Nueva Simulaci칩n
        </button>
      </div>

      <div class="results-grid" *ngIf="simulationData">
        
        <!-- HERO CARD: PR칍XIMA DOSIS -->
        <div class="result-item full-width">
          <app-next-dose-card [simulationData]="simulationData"></app-next-dose-card>
        </div>

        <!-- PESTA칌AS DE NAVEGACI칍N -->
        <div class="result-item full-width">
          <div class="tabs-container">
            <div class="tabs-header">
              <button 
                class="tab-button"
                [class.active]="activeTab === 'graph'"
                (click)="activeTab = 'graph'">
                游늳 Gr치fica
              </button>
              <button 
                class="tab-button"
                [class.active]="activeTab === 'procedure'"
                (click)="activeTab = 'procedure'">
                游빑 Procedimiento
              </button>
              <button 
                class="tab-button"
                [class.active]="activeTab === 'results'"
                (click)="activeTab = 'results'">
                游늶 Resultados
              </button>
            </div>

            <div class="tabs-content">
              
              <!-- TAB 1: GR츼FICA -->
              <div class="tab-panel" *ngIf="activeTab === 'graph'">
                <app-chart-display [data]="simulationData"></app-chart-display>
              </div>

              <!-- TAB 2: PROCEDIMIENTO MATEM츼TICO -->
              <div class="tab-panel" *ngIf="activeTab === 'procedure'">
                <app-math-procedure 
                  [simulationData]="simulationData"
                  [patientData]="patientData"
                  [medicationData]="medicationData">
                </app-math-procedure>
              </div>

              <!-- TAB 3: RESULTADOS NUM칄RICOS -->
              <div class="tab-panel" *ngIf="activeTab === 'results'">
                <app-results-panel [data]="simulationData"></app-results-panel>
              </div>

            </div>
          </div>
        </div>

      </div>

      <div class="no-data" *ngIf="!simulationData">
        <p>丘멆잺 No hay datos para mostrar</p>
        <button (click)="onCancel()">Volver al inicio</button>
      </div>

    </div>
  </div>

</div>
